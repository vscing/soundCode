# 微前端

## 微前端架构实践中的问题

可以发现，微前端架构的优势，正是 MPA 与 SPA 架构优势的合集。即保证应用具备独立开发权的同时，又有将它们整合到一起保证产品完整的流程体验的能力。

## 实现形式

### iframe

```md
iframe 是 html 提供的标签，能加载其他web应用的内容，并且它能兼容所有的浏览器，因此，你可以用它来加载任何你想要加载的web应用。

iframe最大的特性就是提供了浏览器原生的硬隔离方案，不论是样式隔离、js 隔离这类问题统统都能被完美解决。iframe与微前端概念中提到的独立开发、独立维护、相互隔离非常的吻合。

qiankun技术圆桌中一篇《关于微前端Why Not Iframe的思考》，总结的很到位，现复述其中的一段描述

iframe虽然基本能做到微前端所要做的所有事情，但它的最大问题也在于他的隔离性无法被突破，导致应用间上下文无法被共享，随之带来开发体验、产品体验的问题。

文中对 iframe 的总结：

不是单页应用，不会影响外部的路由地址，无法记住当前访问的页面地址，会导致浏览器刷新页面 iframe url 状态丢失、后退前进按钮无法使用。
弹框类的功能无法应用到整个大应用中，只能在对应的窗口内展示。
由于可能应用间不是在相同的域内，主应用的 cookie 要透传到根域名都不同的子应用中才能实现免登录效果。
每次子应用进入都是一次浏览器上下文重建、资源重新加载的过程，占用大量资源的同时也在极大地消耗资源。
iframe的特性导致搜索引擎无法获取到其中的内容，进而无法实现应用的 seo
```

### Web Components

```md
或许很多小伙伴对Web Components不是很了解,它是由google推出的浏览器的原生组件,MDN对Web Components的定义是这样的：

作为开发者，我们都知道尽可能多的重用代码是一个好主意。这对于自定义标记结构来说通常不是那么容易 — 想想复杂的HTML（以及相关的样式和脚本），有时您不得不写代码来呈现自定义UI控件，并且如果您不小心的话，多次使用它们会使您的页面变得一团糟。
Web Components旨在解决这些问题 — 它由三项主要技术组成，它们可以一起使用来创建封装功能的定制元素，可以在你喜欢的任何地方重用，不必担心代码冲突。

它的三项主要技术是指：

Custom elements（自定义元素）：一组JavaScript API，允许您定义custom elements及其行为，然后可以在您的用户界面中按照需要使用它们。
Shadow DOM（影子DOM）：一组JavaScript API，用于将封装的“影子”DOM树附加到元素（与主文档DOM分开呈现）并控制其关联的功能。通过这种方式，您可以保持元素的功能私有，这样它们就可以被脚本化和样式化，而不用担心与文档的其他部分发生冲突。
HTML templates（HTML模板）： 和 元素使您可以编写不在呈现页面中显示的标记模板。然后它们可以作为自定义元素结构的基础被多次重用。
通过以上描述，再结合微前端的概念，我们来看看Web Components是如何做到微前端：

技术栈无关：Web Components是浏览器原生组件，那即是在任何框架中都可以使用。
独立开发：使用Web Components开发的应用无需与其他应用间产生任何关联。
应用间隔离：Shadow DOM的特性，各个引入的微应用间可以达到相互隔离的效果。
综上所述，Web Components是有能力以组件加载的方式将微应用整合在一起作为微前端的一种手段，但不幸的是，Web Components是浏览器的新特性，所以它的兼容性不是很好，如果有兼容性要求的项目还是无法使用，具体请查看can i use。
```

### ESM

```md
ESM是ES Module的缩写，是Ecma script 2015中提出的一种前端模块化手段，那么，它又是如何做到微前端的呢？其实，微前端无外乎三大特性，无技术栈限制、应用单独开发，多应用整合，只要抓住了这三个特性，那就不难理解ESM如何做的了：

无技术栈限制：ESM加载的只是js内容，无论哪个框架，最终都要编译成js，因此，无论哪种框架，ESM都能加载。
应用单独开发：ESM只是js的一种规范，不会影响应用的开发模式。
多应用整合：只要将微应用以ESM的方式暴露出来，就能正常加载。
远程加载模块: ESM能够直接请求cdn资源，这是它与生俱来的能力。
ESM是能做到微前端的核心思想，但是它也存在着兼容性这一大弊端，尽管ESM已经很优秀了，但是大部分老版的浏览器仍然无法直接使用，这也是babel等编译工具出现的原因，幸运的是，他可以通过webpack、rollup、esbuild、snowpack等编译工具成为兼容性的代码。
```

### 服务端模板渲染组合

```md
通过nginx匹配路由的方式 /app /app1 /app2
```

### 微前端框架 single-spa

```md
qiankun和microapp
```

[参考](https://zendev.com/2019/06/17/microfrontends-good-bad-ugly.html)
